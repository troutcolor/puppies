<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Puppies</title>
  <meta name="description" content="DS106 Daily Create 1550 Make a puppy video.">
  <meta name="author" content="John Johnston">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
 
<style type="text/css" media="screen">
html{height: 100%;
}
body{background-size:cover;height:100%;background-repeat:no-repeat; background-position:center center;  background-attachment: fixed; padding:0px;margin:0px;font-family: Helvetica, "MS Trebuchet", sans-serif;}
.footer {
  position: absolute;
  right: 0;
  bottom: 0;
  left: 0;
  padding: 1rem;
  background-color: #191919;
  color:#fff;
  text-align: center;
  opacity: 0.5;
  font-family: Helvetica, "MS Trebuchet", sans-serif;
}
#searchstrip{
    background-color: #191919;
    color:#fff;
     opacity: 0.5;
    
	padding:4px;
}
#showinfo{float:right;}
#puppies{margin: 100px auto;color:#fff;background-color: #191919;opacity:0.5;padding:20px;cursor: pointer;}
</style>

 
   
</head>

<body>
	<div id="searchstrip">
		Don't like puppies then search: <input type="text" name="search" value="" id="search" > <button onclick="reload();">Search</button> or <button onclick="load('cat')">Cats</button>, <button onclick="load('bear')">Bears</button> or <button onclick="load('lion')">Lions</button>. <button onclick="showinfo();" id="showinfo">i</button>
	</div>
	<div id="puppies">
		<p>This is a page made in response to the DS106 daily create of 6th April 2016. I've used it to learn a little bit about git, github and hosting pages on github. Very much inspired by @cogdog.</p>
		
	</div>
	<div class="footer" id="credit">
		 
	</div>

 
 <script type="text/javascript">
	var sounds;
	var gifs;
	var currentSound=0;
	var currentGif=0;
	 


	var audioPlayer= document.createElement("AUDIO");
	  
		 

		 var loadSounds =function(thesound)	{	 
		 
			 var searchsound=$('#sounds').val();
			 var searchurl="//www.freesound.org/apiv2/search/text/?query="+thesound+"&fields=name,previews,license,username,images,url&token=3e9dcbd0957ae4e0f6e6323dec5c5b71e01f617d&page_size=100";
 	 	$.ajax({
 	 	  url: searchurl,
 	 	  type: 'GET',
  dataType: 'json',
  complete: function(xhr, textStatus) {
 	 	    //called when complete
 	 	  },
  success: function(data, textStatus, xhr) {
 	 	    //called when successful
	  //console.log(data);
	  sounds=data;
	  console.log(sounds);
	  startSounds();
 	 	  },
  error: function(xhr, textStatus, errorThrown) {
 	 	    //called when there is an error
 	 	  }
});

}

var loadGifs=function(thegif){
 var searchgif=$('#gifs').val();
 var searchurl="//api.giphy.com/v1/gifs/search?q="+thegif+"&api_key=dc6zaTOxFJmzC&limit=100";

$.ajax({
  url: searchurl,
  type: 'GET',
  dataType: 'json',
  complete: function(xhr, textStatus) {
    //called when complete
  },
  success: function(data, textStatus, xhr) {
    //called when successful
	  gifs=data;
	  startGifs();
  },
  error: function(xhr, textStatus, errorThrown) {
    //called when there is an error
  }
});

}

var startSounds = function(){
	shuffle(sounds.results);
	
	 
		
		audioPlayer.src=sounds['results'][0].previews['preview-lq-mp3'];
		//audioPlayer.loop=true;
		audioPlayer.play();
		audioPlayer.addEventListener("ended", playNext);
		
		
	 
	 
		var thelicense= sounds['results'][0].license.split('/');
		var thislicense= thelicense[4];
			
		$( '#credit' ).html("Sound: "+ sounds['results'][0].name +" by "+ sounds['results'][0].username +" license CC "+ thislicense );
	 
		
	
}

var playNext=function(){
	currentSound++;
	if (currentSound >= sounds.length){currentSound=0;}
	audioPlayer.src=sounds['results'][currentSound].previews['preview-lq-mp3'];
	audioPlayer.play();
	console.log(sounds['results'][currentSound].previews['preview-lq-mp3']);
	
	var thelicense= sounds['results'][currentSound].license.split('/');
	var thislicense= thelicense[4];
		
	$( '#credit' ).html("Sound: "+ sounds['results'][currentSound].name +" by "+ sounds['results'][currentSound].username +" license: CC "+ thislicense );
	
}

var startGifs=function(){
	gifhtml="";
	shuffle(gifs.data);
	 
	$("body").css("background-image", "url("+ gifs.data[0].images.original.url +")");
			
			//$('.giphylink')[i].href=gifs.data[i].source ;
			//gifurl=gifs.data[i].images.original.url;

	    };
 
   	 var gifTimer=function(){
   		 currentGif++;
   		 if (currentGif>=gifs.data.length){currentGif=0;}
   		$("body").css("background-image", "url("+ gifs.data[currentGif].images.original.url +")");
		var preload = new Image();
		preload.src=gifs.data[currentGif+1].images.original.url;
   	 }
	 
	 
	 function shuffle(array) {
	   var currentIndex = array.length, temporaryValue, randomIndex ;

	   // While there remain elements to shuffle...
	   while (0 !== currentIndex) {

	     // Pick a remaining element...
	     randomIndex = Math.floor(Math.random() * currentIndex);
	     currentIndex -= 1;

	     // And swap it with the current element.
	     temporaryValue = array[currentIndex];
	     array[currentIndex] = array[randomIndex];
	     array[randomIndex] = temporaryValue;
	   }

	   return array;
	 }
	 
	 var reload=function(){
		  
		 var search=$('#search').val();
		 if(search!=""){
		 loadSounds(search);
		 loadGifs(search);
	 }
	 }
	 
	 var load=function(thestring){
		 $('#search').val(thestring);
		 loadSounds(thestring);
		 reload();
	 }
	
	 $(document).ready(function() {
		  $('#puppies').hide();
		  $('#puppies').click(function(){$(this).hide();});
		 loadSounds('dog');
		 loadGifs('puppy');
		 setInterval(gifTimer,10000)
	 });
	 
	 var showinfo=function(){
		 $('#puppies').show();
	 }
 	 
 </script>
	
 </body>
</html>	